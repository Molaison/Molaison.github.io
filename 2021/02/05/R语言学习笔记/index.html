<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>R语言学习笔记 | Molaison's blogs</title><meta name="keywords" content="data analysis"><meta name="author" content="Molaison"><meta name="copyright" content="Molaison"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="R语言tidyverse系列包数据处理的方法，介绍各个子包的函数使用效果及方法; 更加重要的是这些函数的处理逻辑, 是&#96;vector-wise&#96;还是&#96;row-wise&#96;还是&#96;element-wise&#96;.">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言学习笔记">
<meta property="og:url" content="https://github.com/Molaison/Molaison.github.io/2021/02/05/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Molaison&#39;s blogs">
<meta property="og:description" content="R语言tidyverse系列包数据处理的方法，介绍各个子包的函数使用效果及方法; 更加重要的是这些函数的处理逻辑, 是&#96;vector-wise&#96;还是&#96;row-wise&#96;还是&#96;element-wise&#96;.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2021-02-05T04:17:09.000Z">
<meta property="article:modified_time" content="2023-06-09T12:11:32.066Z">
<meta property="article:author" content="Molaison">
<meta property="article:tag" content="data analysis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/Molaison/IMages/IMG/2022/10/1820221018082037.png"><link rel="canonical" href="https://github.com/Molaison/Molaison.github.io/2021/02/05/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'R语言学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-09 20:11:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gcore.jsdelivr.net/gh/Molaison/IMages/IMG/2022/10/1820221018081403.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Molaison's blogs</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">R语言学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-05T04:17:09.000Z" title="发表于 2021-02-05 12:17:09">2021-02-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-09T12:11:32.066Z" title="更新于 2023-06-09 20:11:32">2023-06-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/skill-learning/">skill learning</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="R语言学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="Tidyverse"><a href="#Tidyverse" class="headerlink" title="Tidyverse"></a>Tidyverse</h2><h3 id="dplyr包-数据转换"><a href="#dplyr包-数据转换" class="headerlink" title="dplyr包: 数据转换"></a>dplyr包: 数据转换</h3><h4 id="数据和包载入"><a href="#数据和包载入" class="headerlink" title="数据和包载入"></a>数据和包载入</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>nycflights13<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">nycflights13<span class="operator">::</span>flights</span><br></pre></td></tr></table></figure>
<h4 id="基础函数"><a href="#基础函数" class="headerlink" title="基础函数"></a>基础函数</h4><p>以下5个函数参数相同:</p>
<ol>
<li>第一个参数为数据框;</li>
<li>随后参数使用变量名称(不带引号)描述操作;</li>
<li>返回一个新的数据框;</li>
</ol>
<h5 id="filter-按值筛选"><a href="#filter-按值筛选" class="headerlink" title="filter(): 按值筛选"></a>filter(): 按值筛选</h5><p>基于筛选条件筛选出观测子集:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">==</span> x_1<span class="punctuation">,</span> colname_2 <span class="operator">==</span> x_2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#筛选出第一列中值为x_1,和第二列中值为x_2的行</span></span><br><span class="line"><span class="punctuation">(</span>subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">==</span> x_1<span class="punctuation">,</span> colname_2 <span class="operator">==</span> x_2<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#在console中直接显示结果同时将值储存进subset</span></span><br></pre></td></tr></table></figure>
<h6 id="基于比较符"><a href="#基于比较符" class="headerlink" title="基于比较符"></a>基于比较符</h6><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">&gt;=</span> x_1<span class="punctuation">,</span> colname_2 <span class="operator">&lt;=</span> x_2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#比较运算符有: &gt;,&lt;,&lt;=,&gt;=,!=,==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于浮点数</span></span><br><span class="line"><span class="built_in">sqrt</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span> <span class="operator">==</span> <span class="number">2</span>  <span class="comment">#FALSE</span></span><br><span class="line"><span class="number">1</span><span class="operator">/</span><span class="number">49</span><span class="operator">*</span><span class="number">49</span> <span class="operator">==</span> <span class="number">1</span> <span class="comment">#FALSE</span></span><br><span class="line"><span class="comment">#通常使用near()函数</span></span><br><span class="line">near<span class="punctuation">(</span><span class="built_in">sqrt</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span>  <span class="comment">#TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于区间</span></span><br><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> between<span class="punctuation">(</span>colname_1<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#选出位于区间(3,9)之间的colname值</span></span><br></pre></td></tr></table></figure>
<h6 id="基于逻辑符"><a href="#基于逻辑符" class="headerlink" title="基于逻辑符"></a>基于逻辑符</h6><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">&gt;=</span> x_1<span class="operator">|</span>colname_1 <span class="operator">&gt;=</span> x_3<span class="punctuation">)</span><span class="comment">#或</span></span><br><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">&gt;=</span> x_1<span class="operator">&amp;</span>colname_1 <span class="operator">&gt;=</span> x_3<span class="punctuation">)</span><span class="comment">#与</span></span><br><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> <span class="operator">!</span><span class="punctuation">(</span>colname_1 <span class="operator">&gt;=</span> x_1<span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#非</span></span><br><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span> colname_1 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span>x_1<span class="punctuation">,</span>x_2<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h6 id="缺失值"><a href="#缺失值" class="headerlink" title="缺失值"></a>缺失值</h6><blockquote>
<p>缺失值 :  称为NA（Not available，不可用）</p>
</blockquote>
<p>对于缺失值的操作也都是缺失值（大多数情况）；</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NA</span> <span class="operator">==</span> <span class="literal">NA</span></span><br><span class="line"><span class="comment"># 值为NA</span></span><br><span class="line">x <span class="operator">=</span> <span class="literal">NA</span>;</span><br><span class="line"><span class="built_in">is.na</span><span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#TRUE</span></span><br></pre></td></tr></table></figure>
<p>在筛选器中,为NA值得行和条件为FALSE的行会被过滤,如果需要保留;</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>parentset<span class="punctuation">,</span><span class="built_in">is.na</span><span class="punctuation">(</span>colname_1<span class="punctuation">)</span><span class="operator">|</span>colname_1 <span class="operator">&gt;=</span> x_3<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>其他NA特殊操作的值:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NA</span><span class="operator">^</span><span class="number">0</span> <span class="comment">#=0</span></span><br><span class="line"><span class="literal">NA</span><span class="operator">|</span><span class="literal">TRUE</span> <span class="comment">#TRUE</span></span><br><span class="line"><span class="literal">NA</span><span class="operator">*</span><span class="number">0</span> <span class="comment">#=NA</span></span><br></pre></td></tr></table></figure>
<h5 id="arrange-对行排序"><a href="#arrange-对行排序" class="headerlink" title="arrange(): 对行排序"></a>arrange(): 对行排序</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> arrange<span class="punctuation">(</span>parentset<span class="punctuation">,</span> col_1<span class="punctuation">,</span> col_2<span class="punctuation">,</span> col_3<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#首先根据列1排序,再对列2排序,表示如果数据在“变量1”的值相同时按照“变量2”排序</span></span><br><span class="line">subset <span class="operator">&lt;-</span> arrange<span class="punctuation">(</span>parentset<span class="punctuation">,</span> desc<span class="punctuation">(</span>col_1<span class="punctuation">)</span><span class="punctuation">,</span> col_2<span class="punctuation">,</span> col_3<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#desc()函数使之降序排列,即descend</span></span><br><span class="line"><span class="comment">#缺失值无论降序还是升序,总是在最后</span></span><br></pre></td></tr></table></figure>
<h5 id="select-按名称选取"><a href="#select-按名称选取" class="headerlink" title="select(): 按名称选取"></a>select(): 按名称选取</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> select<span class="punctuation">(</span>parentset<span class="punctuation">,</span> col_1<span class="punctuation">,</span> col_2<span class="punctuation">,</span> col_3<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#选取第1,2,3列</span></span><br><span class="line">subset <span class="operator">&lt;-</span> select<span class="punctuation">(</span>parentset<span class="punctuation">,</span> col_1<span class="operator">:</span>col_3<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#也是选取1:3列</span></span><br><span class="line">subset <span class="operator">&lt;-</span> select<span class="punctuation">(</span>parentset<span class="punctuation">,</span> <span class="operator">-</span><span class="punctuation">(</span>col_1<span class="operator">:</span>col_3<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#选取不在1:3列间的列</span></span><br></pre></td></tr></table></figure>
<h6 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h6><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">starts_with<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="operator">:</span> <span class="comment">#以str开头的名称</span></span><br><span class="line"></span><br><span class="line">end_with<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="operator">:</span> <span class="comment">#以str结尾的名称</span></span><br><span class="line"></span><br><span class="line">contains<span class="punctuation">(</span>str<span class="punctuation">)</span><span class="operator">:</span><span class="comment">#包含str的名称</span></span><br><span class="line"></span><br><span class="line">matches<span class="punctuation">(</span>pattern<span class="punctuation">)</span><span class="operator">:</span><span class="comment">#匹配正则pattern的名称</span></span><br><span class="line"></span><br><span class="line">num_range<span class="punctuation">(</span><span class="string">&quot;X&quot;</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">)</span><span class="operator">:</span><span class="comment">#匹配 &#123;X1, X2, X3, X4 &#125;,神技</span></span><br><span class="line"><span class="comment">#会默认忽略大小写,如果要区分大小写，可以设置任意帮助函数的参数ignore.case = FALSE</span></span><br></pre></td></tr></table></figure>
<p>select可以重命名变量,但是会丢失其他变量:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> select<span class="punctuation">(</span>parentset<span class="punctuation">,</span> newname<span class="operator">=</span>oldname<span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用select的变体可以保留其他变量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename<span class="punctuation">(</span>parentset<span class="punctuation">,</span> newname<span class="operator">=</span>oldname<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>也可以使用everything()函数进行列排序:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> select<span class="punctuation">(</span>parentset<span class="punctuation">,</span> col5<span class="punctuation">,</span>col3<span class="punctuation">,</span>everything<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#原顺序为1,2,3,4,5,现在为5,3,1,2,4</span></span><br></pre></td></tr></table></figure>
<p>one_of(character_1,···,character_n):如果某个列的名字出现在序列里，则选出它</p>
<h5 id="mutate-使用函数创建新变量"><a href="#mutate-使用函数创建新变量" class="headerlink" title="mutate(): 使用函数创建新变量"></a>mutate(): 使用函数创建新变量</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subset <span class="operator">&lt;-</span> mutate<span class="punctuation">(</span>parentset<span class="punctuation">,</span> newcol1<span class="operator">=</span>col1<span class="operator">/</span>col2<span class="punctuation">,</span>newcol2<span class="operator">=</span>new1<span class="operator">/</span>col1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>上述代码产生了两个新列, 总是加在数据框最后</li>
<li>新列按顺序产生, 列一经产生即可使用(new2使用了new1)</li>
<li>运算法则:<ul>
<li>加减乘除 “+”, “-”,”*”,”/”,”^”</li>
<li>模运算:”%/%”整除,”%%”求余</li>
<li>对数:log(),log2(),log10();</li>
<li>偏移函数:lead(),lag(),前移或者后移一位</li>
<li>累加,滚动聚合: 累加和,积,最小值,最大值:cumsum(), cumprod(), cummin(),cummax()</li>
</ul>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transmute<span class="punctuation">(</span>parentset<span class="punctuation">,</span> newcol1<span class="operator">=</span>col1<span class="operator">/</span>col2<span class="punctuation">,</span>newcol2<span class="operator">=</span>new1<span class="operator">/</span>col1<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>只保留新的变量;</p>
<h5 id="summarize-摘要统计量"><a href="#summarize-摘要统计量" class="headerlink" title="summarize(): 摘要统计量"></a>summarize(): 摘要统计量</h5><p>summarize()，它可以将数据框折叠成一行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">summarize<span class="punctuation">(</span>flights<span class="punctuation">,</span> delay <span class="operator">=</span> mean<span class="punctuation">(</span>dep_delay<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 1 × 1</span></span><br><span class="line"><span class="comment">#&gt; delay</span></span><br><span class="line"><span class="comment">#&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 12.6</span></span><br></pre></td></tr></table></figure>
<p>group_by() 可以将分析单位从整个数据集更改为单个分组.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">by_day <span class="operator">&lt;-</span> group_by<span class="punctuation">(</span>flights<span class="punctuation">,</span> year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">)</span></span><br><span class="line">summarize<span class="punctuation">(</span>by_day<span class="punctuation">,</span> delay <span class="operator">=</span> mean<span class="punctuation">(</span>dep_delay<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Source: local data frame [365 x 4]</span></span><br><span class="line"><span class="comment">#&gt; Groups: year, month [?]</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"><span class="comment">#&gt; year month day delay</span></span><br><span class="line"><span class="comment">#&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 2013 1 1 11.55</span></span><br><span class="line"><span class="comment">#&gt; 2 2013 1 2 13.86</span></span><br><span class="line"><span class="comment">#&gt; 3 2013 1 3 10.99</span></span><br><span class="line"><span class="comment">#&gt; 4 2013 1 4 8.95</span></span><br><span class="line"><span class="comment">#&gt; 5 2013 1 5 5.73</span></span><br><span class="line"><span class="comment">#&gt; 6 2013 1 6 7.15</span></span><br></pre></td></tr></table></figure>
<h5 id="管道操作符"><a href="#管道操作符" class="headerlink" title="管道操作符"></a>管道操作符</h5><p>即: “%&gt;%”, 将返回值传递给管道符后的操作函数作为输入,通常可读作然后:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">delays <span class="operator">&lt;-</span> flights <span class="operator">%&gt;%</span></span><br><span class="line"> group_by<span class="punctuation">(</span>dest<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line"> summarize<span class="punctuation">(</span></span><br><span class="line">  count <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  dist <span class="operator">=</span> mean<span class="punctuation">(</span>distance<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  delay <span class="operator">=</span> mean<span class="punctuation">(</span>arr_delay<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line"> filter<span class="punctuation">(</span>count <span class="operator">&gt;</span> <span class="number">20</span><span class="punctuation">,</span> dest <span class="operator">!=</span> <span class="string">&quot;HNL&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h5 id="缺失值忽略参数"><a href="#缺失值忽略参数" class="headerlink" title="缺失值忽略参数"></a>缺失值忽略参数</h5><p>na.rm=TRUE参数可以在计算前除去缺失值;</p>
<h5 id="计数参数"><a href="#计数参数" class="headerlink" title="计数参数"></a>计数参数</h5><p>即n(), 它的值是操作单位中值的个数;</p>
<h5 id="常见摘要函数"><a href="#常见摘要函数" class="headerlink" title="常见摘要函数"></a>常见摘要函数</h5><h6 id="位置-median-和mean"><a href="#位置-median-和mean" class="headerlink" title="位置: median()和mean()"></a>位置: median()和mean()</h6><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled <span class="operator">%&gt;%</span></span><br><span class="line">group_by<span class="punctuation">(</span>year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">summarize<span class="punctuation">(</span></span><br><span class="line"><span class="comment"># 平均延误时间：</span></span><br><span class="line">avg_delay1 <span class="operator">=</span> mean<span class="punctuation">(</span>arr_delay<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment"># 50%的x大于它，同时50%的x小于它。</span></span><br><span class="line">avg_delay2 <span class="operator">=</span> median<span class="punctuation">(</span>arr_delay<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h6 id="分散程度-sd-x-、IQR-x-和mad-x"><a href="#分散程度-sd-x-、IQR-x-和mad-x" class="headerlink" title="分散程度: sd(x)、IQR(x) 和mad(x)"></a>分散程度: sd(x)、IQR(x) 和mad(x)</h6><p>分别是标准差, 四分位距, 绝对中位差;</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled <span class="operator">%&gt;%</span></span><br><span class="line">group_by<span class="punctuation">(</span>dest<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">summarize<span class="punctuation">(</span>distance_sd <span class="operator">=</span> sd<span class="punctuation">(</span>distance<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h6 id="秩-min-x-、quantile-x-0-25-和max-x"><a href="#秩-min-x-、quantile-x-0-25-和max-x" class="headerlink" title="秩: min(x)、quantile(x, 0.25) 和max(x)"></a>秩: min(x)、quantile(x, 0.25) 和max(x)</h6><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled <span class="operator">%&gt;%</span></span><br><span class="line">group_by<span class="punctuation">(</span>year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">summarize<span class="punctuation">(</span></span><br><span class="line">first <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>dep_time<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">last <span class="operator">=</span> <span class="built_in">max</span><span class="punctuation">(</span>dep_time<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h6 id="定位度量：first-x-、nth-x-2-和last-x"><a href="#定位度量：first-x-、nth-x-2-和last-x" class="headerlink" title="定位度量：first(x)、nth(x, 2) 和last(x)"></a>定位度量：first(x)、nth(x, 2) 和last(x)</h6><p>和索引取值的区别在于,当定位不存在时取默认值位置;</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled <span class="operator">%&gt;%</span></span><br><span class="line">group_by<span class="punctuation">(</span>year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">summarize<span class="punctuation">(</span></span><br><span class="line">first_dep <span class="operator">=</span> first<span class="punctuation">(</span>dep_time<span class="punctuation">)</span><span class="punctuation">,</span>last_dep <span class="operator">=</span> last<span class="punctuation">(</span>dep_time<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h6 id="计数-count"><a href="#计数-count" class="headerlink" title="计数:count()"></a>计数:count()</h6><p>唯一值计数:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n_distinct<span class="punctuation">(</span><span class="punctuation">)</span>;</span><br></pre></td></tr></table></figure>
<p>加权计数:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count<span class="punctuation">(</span>df <span class="punctuation">,</span> wt<span class="operator">=</span> weight<span class="punctuation">)</span><span class="comment">#weight可以是其他列或者别的权重</span></span><br></pre></td></tr></table></figure>
<h6 id="逻辑值计数-sum-x-gt-a-和mean-x-0"><a href="#逻辑值计数-sum-x-gt-a-和mean-x-0" class="headerlink" title="逻辑值计数: sum(x&gt;a)和mean(x==0)"></a>逻辑值计数: sum(x&gt;a)和mean(x==0)</h6><p>sum()使用逻辑表达式计数可以计算true值的个数;</p>
<p>而mean则可以直接获得比例,因为true值为1,FALSE为0;</p>
<h5 id="按多个变量分组"><a href="#按多个变量分组" class="headerlink" title="按多个变量分组"></a>按多个变量分组</h5><p>当使用多个变量进行分组时，每次的摘要统计会==用掉一个分组变量==。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">daily <span class="operator">&lt;-</span> group_by<span class="punctuation">(</span>flights<span class="punctuation">,</span> year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>per_day <span class="operator">&lt;-</span> summarize<span class="punctuation">(</span>daily<span class="punctuation">,</span> flights <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Source: local data frame [365 x 4]</span></span><br><span class="line"><span class="comment">#&gt; Groups: year, month [?]</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"><span class="comment">#&gt; year month day flights</span></span><br><span class="line"><span class="comment">#&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 2013 1 1 842</span></span><br><span class="line"><span class="comment">#&gt; 2 2013 1 2 943</span></span><br><span class="line"><span class="comment">#&gt; 3 2013 1 3 914</span></span><br><span class="line"><span class="comment">#&gt; 4 2013 1 4 915</span></span><br><span class="line"><span class="comment">#&gt; 5 2013 1 5 720</span></span><br><span class="line"><span class="comment">#&gt; 6 2013 1 6 832</span></span><br><span class="line"><span class="comment">#&gt; # ... with 359 more rows</span></span><br><span class="line"><span class="punctuation">(</span>per_month <span class="operator">&lt;-</span> summarize<span class="punctuation">(</span>per_day<span class="punctuation">,</span> flights <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>flights<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Source: local data frame [12 x 3]</span></span><br><span class="line"><span class="comment">#&gt; Groups: year [?]</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"><span class="comment">#&gt; year month flights</span></span><br><span class="line"><span class="comment">#&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 2013 1 27004</span></span><br><span class="line"><span class="comment">#&gt; 2 2013 2 24951</span></span><br><span class="line"><span class="comment">#&gt; 3 2013 3 28834</span></span><br><span class="line"><span class="comment">#&gt; 4 2013 4 28330</span></span><br><span class="line"><span class="comment">#&gt; 5 2013 5 28796</span></span><br><span class="line"><span class="punctuation">(</span>per_year <span class="operator">&lt;-</span> summarize<span class="punctuation">(</span>per_month<span class="punctuation">,</span> flights <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>flights<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 1 × 2</span></span><br><span class="line"><span class="comment">#&gt; year flights</span></span><br><span class="line"><span class="comment">#&gt; &lt;int&gt; &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 2013 336776</span></span><br></pre></td></tr></table></figure>
<ol>
<li>但是取加权平均或者方差或者中位数时,很容易出错,因为对整体取中位数和分组取中位数在取中位数完全不同;</li>
<li>可以用ungroup()取消分组</li>
</ol>
<h3 id="tibble数据框"><a href="#tibble数据框" class="headerlink" title="tibble数据框"></a>tibble数据框</h3><h4 id="创建tibble数据框"><a href="#创建tibble数据框" class="headerlink" title="创建tibble数据框"></a>创建tibble数据框</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">as_tibble<span class="punctuation">(</span>df<span class="punctuation">)</span><span class="comment">#从普通数据框转换</span></span><br><span class="line"></span><br><span class="line">tibble<span class="punctuation">(</span>x<span class="operator">=</span>vector<span class="punctuation">,</span>y<span class="operator">=</span>vector<span class="punctuation">,</span>z<span class="operator">=</span>vector<span class="punctuation">)</span><span class="comment">#直接创建</span></span><br></pre></td></tr></table></figure>
<ul>
<li>tibble相比较data.frame: 不能改变输入的类型（例如，不能将字符串转换为因子）、变量的名称，也不能创建行名称。</li>
<li>可以在tibble 中使用在R 中无效的变量名称（即不符合语法的名称)作为列名,需要使用反引号` 将它们括起来</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tb <span class="operator">&lt;-</span> tibble<span class="punctuation">(</span></span><br><span class="line">`:)` <span class="operator">=</span> <span class="string">&quot;smile&quot;</span><span class="punctuation">,</span></span><br><span class="line">` ` <span class="operator">=</span> <span class="string">&quot;space&quot;</span><span class="punctuation">,</span></span><br><span class="line">`<span class="number">2000</span>` = &quot;number&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>transposed tibble: 列标题由公式（以~ 开头）<br>定义，数据条目以逗号分隔，对少量数据进行布局</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tribble<span class="punctuation">(</span></span><br><span class="line">    <span class="operator">~</span>x<span class="punctuation">,</span> <span class="operator">~</span>y<span class="punctuation">,</span> <span class="operator">~</span>z<span class="punctuation">,</span></span><br><span class="line">    <span class="comment">#--|--|----</span></span><br><span class="line">    <span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3.6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">8.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 2 × 3</span></span><br><span class="line"><span class="comment">#&gt; x y z</span></span><br><span class="line"><span class="comment">#&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 a 2 3.6</span></span><br><span class="line"><span class="comment">#&gt; 2 b 1 8.5</span></span><br></pre></td></tr></table></figure>
<h5 id="打印tibble"><a href="#打印tibble" class="headerlink" title="打印tibble()"></a>打印tibble()</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">tibble<span class="punctuation">(</span></span><br><span class="line">a <span class="operator">=</span> lubridate<span class="operator">::</span>now<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> runif<span class="punctuation">(</span><span class="number">1e3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">86400</span><span class="punctuation">,</span></span><br><span class="line">b <span class="operator">=</span> lubridate<span class="operator">::</span>today<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> runif<span class="punctuation">(</span><span class="number">1e3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line"><span class="built_in">c</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">1e3</span><span class="punctuation">,</span></span><br><span class="line">d <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">1e3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">e <span class="operator">=</span> sample<span class="punctuation">(</span><span class="built_in">letters</span><span class="punctuation">,</span> <span class="number">1e3</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 1,000 × 5</span></span><br><span class="line"><span class="comment">#&gt; a b c d e</span></span><br><span class="line"><span class="comment">#&gt; &lt;dttm&gt; &lt;date&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 2016-10-10 17:14:14 2016-10-17 1 0.368 h</span></span><br><span class="line"><span class="comment">#&gt; 2 2016-10-11 11:19:24 2016-10-22 2 0.612 n</span></span><br><span class="line"><span class="comment">#&gt; 3 2016-10-11 05:43:03 2016-11-01 3 0.415 l</span></span><br><span class="line"><span class="comment">#&gt; 4 2016-10-10 19:04:20 2016-10-31 4 0.212 x</span></span><br><span class="line"><span class="comment">#&gt; 5 2016-10-10 15:28:37 2016-10-28 5 0.733 a</span></span><br><span class="line"><span class="comment">#&gt; 6 2016-10-11 02:29:34 2016-10-24 6 0.460 v</span></span><br><span class="line"><span class="comment">#&gt; # ... with 994 more rows</span></span><br><span class="line">nycflights13<span class="operator">::</span>flights <span class="operator">%&gt;%</span></span><br><span class="line"> print<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="literal">Inf</span><span class="punctuation">)</span><span class="comment">#width显示宽度,n为行数</span></span><br><span class="line"><span class="comment">#可通过设置选项(option)控制默认打印方式</span></span><br><span class="line">options<span class="punctuation">(</span>tibble.print_max <span class="operator">=</span> n<span class="punctuation">,</span> tibble.print_min <span class="operator">=</span> m<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h5 id="取子集"><a href="#取子集" class="headerlink" title="取子集"></a>取子集</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df <span class="operator">&lt;-</span> tibble<span class="punctuation">(</span></span><br><span class="line">    x <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    y <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">)</span></span><br><span class="line">df<span class="operator">$</span>x <span class="comment">#$只能通过名字提取</span></span><br><span class="line">df<span class="punctuation">[[</span><span class="string">&quot;x&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">df<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="comment"># 双中括号既可以按名称也可以按位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#与管道符结合</span></span><br><span class="line">df <span class="operator">%&gt;%</span> .<span class="operator">$</span>x <span class="comment">#.为占位符,功能如其名</span></span><br><span class="line"><span class="comment">#&gt; [1] 0.434 0.395 0.548 0.762 0.254</span></span><br><span class="line">df <span class="operator">%&gt;%</span> .<span class="punctuation">[[</span><span class="string">&quot;x&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">#&gt; [1] 0.434 0.395 0.548 0.762 0.254</span></span><br></pre></td></tr></table></figure>
<h3 id="readr"><a href="#readr" class="headerlink" title="readr"></a>readr</h3><h4 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h4><ul>
<li>csv文件: read_csv()读取逗号分隔文件、read_csv2() 读取分号分隔文件（这在用, 表示小数位的国家非常普遍）、read_tsv() 读取制表符分隔文件、read_delim() 可以读取使用任意分隔符的文件。</li>
<li>read_fwf() 读取固定宽度的文件。既可以使用fwf_widths() 函数按照宽度来设定域，也可以使用fwf_positions() 函数按照位置来设定域。read_table() 读取固定宽度文件的一种常用变体，其中使用空白字符来分隔各列。</li>
</ul>
<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><p>direction: 绝对or相对路径</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">heights <span class="operator">&lt;-</span> read_csv<span class="punctuation">(</span><span class="string">&quot;data/heights.csv&quot;</span><span class="punctuation">)</span></span><br><span class="line">read_csv<span class="punctuation">(</span><span class="string">&quot;a,b,c</span></span><br><span class="line"><span class="string">1,2,3</span></span><br><span class="line"><span class="string">4,5,6&quot;</span><span class="punctuation">)</span><span class="comment">#也可以读取行内CSV文件,换行不能省!</span></span><br></pre></td></tr></table></figure>
<p>skip = n:跳过前N行:</p>
<p>comment = char: 丢弃所有以char开头的行,即将其注释掉</p>
<p>col_names = FALSE: 不使用数据的第一行作为列名称(默认为TRUE. 标注为X1 X2 X3 ….;或者使用向量为其命名;</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read_csv<span class="punctuation">(</span><span class="string">&quot;1,2,3\n4,5,6&quot;</span><span class="punctuation">,</span> col_names <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;x&quot;</span><span class="punctuation">,</span> <span class="string">&quot;y&quot;</span><span class="punctuation">,</span> <span class="string">&quot;z&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="解析向量"><a href="#解析向量" class="headerlink" title="解析向量"></a>解析向量</h4><ul>
<li>parse_*() 函数族: 接受一个字符向量，并返回一个特定向量，如逻辑、整数或日期向量：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parse_integer<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;231&quot;</span><span class="punctuation">,</span> <span class="string">&quot;.&quot;</span><span class="punctuation">,</span> <span class="string">&quot;456&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> na <span class="operator">=</span> <span class="string">&quot;.&quot;</span><span class="punctuation">)</span><span class="comment">#&quot;na=&quot;哪些字符串应该当作缺失值来处理</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>解析失败的值在输出中是以缺失值的形式存在的</p>
</li>
<li><p>problems() 函数来获取完整的失败信息集合(tibble)</p>
</li>
<li><p>parse_double()解析浮点数,，parse_number() 则是灵活的数值型解析函数。</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">parse_double<span class="punctuation">(</span><span class="string">&quot;1,23&quot;</span><span class="punctuation">,</span> locale <span class="operator">=</span> locale<span class="punctuation">(</span>decimal_mark <span class="operator">=</span> <span class="string">&quot;,&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#“地区&quot;根据地区设置解析选项</span></span><br><span class="line">parse_number<span class="punctuation">(</span></span><br><span class="line"><span class="string">&quot;123.456.789&quot;</span><span class="punctuation">,</span></span><br><span class="line">locale <span class="operator">=</span> locale<span class="punctuation">(</span>grouping_mark <span class="operator">=</span> <span class="string">&quot;.&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#parse_number()忽略数值前后的非数值型字符</span></span><br><span class="line">parse_number<span class="punctuation">(</span><span class="string">&quot;$100&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 100</span></span><br><span class="line">parse_number<span class="punctuation">(</span><span class="string">&quot;20%&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 20</span></span><br><span class="line">parse_number<span class="punctuation">(</span><span class="string">&quot;It cost $123.45&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 123</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>parse_character():</p>
<ul>
<li><p>charToRaw()获得字符串ASCII编码</p>
</li>
<li><p>设定编码方式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">parse_character<span class="punctuation">(</span>x1<span class="punctuation">,</span> locale <span class="operator">=</span> locale<span class="punctuation">(</span>encoding <span class="operator">=</span> <span class="string">&quot;Latin1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;El Niño was particularly bad this year&quot;</span></span><br><span class="line">parse_character<span class="punctuation">(</span>x2<span class="punctuation">,</span> locale <span class="operator">=</span> locale<span class="punctuation">(</span>encoding <span class="operator">=</span> <span class="string">&quot;Shift-JIS&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;こんにちは&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>未知编码方式:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">guess_encoding<span class="punctuation">(</span>charToRaw<span class="punctuation">(</span>x1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; encoding confidence</span></span><br><span class="line"><span class="comment">#&gt; 1 ISO-8859-1 0.46</span></span><br><span class="line"><span class="comment">#&gt; 2 ISO-8859-9 0.23</span></span><br><span class="line">guess_encoding<span class="punctuation">(</span>charToRaw<span class="punctuation">(</span>x2<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; encoding confidence</span></span><br><span class="line"><span class="comment">#&gt; 1 KOI8-R 0.42</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>parse_factor(): R 使用因子表示取值范围是已知集合的分类变量。</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fruit <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">)</span></span><br><span class="line">parse_factor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;apple&quot;</span><span class="punctuation">,</span> <span class="string">&quot;banana&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bananana&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> fruit<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Warning: 1 parsing failure.</span></span><br><span class="line"><span class="comment">#&gt; row col expected actual</span></span><br><span class="line"><span class="comment">#&gt; 3 -- value in level set bananana</span></span><br><span class="line"><span class="comment">#&gt; [1] apple banana &lt;NA&gt;</span></span><br><span class="line"><span class="comment">#&gt; attr(,&quot;problems&quot;)</span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 1 × 4</span></span><br><span class="line"><span class="comment">#&gt; row col expected actual</span></span><br><span class="line"><span class="comment">#&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1 3 NA value in level set bananana</span></span><br><span class="line"><span class="comment">#&gt; Levels: apple banana</span></span><br><span class="line"><span class="comment">#存在向量中没有的值，生成一条警告</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>时间解析:</p>
<ul>
<li><p>parse_datetime():</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parse_datetime<span class="punctuation">(</span><span class="string">&quot;2010-10-01T2010&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;2010-10-01 20:10:00 UTC&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>parse_date():</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parse_date<span class="punctuation">(</span><span class="string">&quot;2010-10-01&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;2010-10-01&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>parse_time():</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>hms<span class="punctuation">)</span></span><br><span class="line">parse_time<span class="punctuation">(</span><span class="string">&quot;20:10:01&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; 20:10:01</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义格式</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">parse_date<span class="punctuation">(</span><span class="string">&quot;01/02/15&quot;</span><span class="punctuation">,</span> <span class="string">&quot;%m/%d/%y&quot;</span><span class="punctuation">)</span></span><br><span class="line">年</span><br><span class="line"><span class="comment">#%Y（4 位数）。</span></span><br><span class="line"><span class="comment">#%y（2 位数；00-69 → 2000-2069、70-99 → 1970-1999）。</span></span><br><span class="line">月</span><br><span class="line"><span class="comment">#%m（2 位数）。</span></span><br><span class="line"><span class="comment">#%b（简写名称，如Jan）。</span></span><br><span class="line"><span class="comment">#%B（完整名称，如January）。</span></span><br><span class="line">日</span><br><span class="line"><span class="comment">#%d（1 位或2 位数）。</span></span><br><span class="line"><span class="comment">#%e（2 位数）</span></span><br><span class="line">时间</span><br><span class="line"><span class="comment">#%H（0-23 小时）。</span></span><br><span class="line"><span class="comment">#%I（0-12 小时，必须和%p 一起使用）。</span></span><br><span class="line"><span class="comment">#%p（表示a.m./p.m.）。</span></span><br><span class="line"><span class="comment">#%M（分钟）。</span></span><br><span class="line"><span class="comment">#%S（整数秒）。</span></span><br><span class="line"><span class="comment">#%OS（实数秒）。</span></span><br><span class="line"><span class="comment">#%Z（时区，America/Chicage 这样的名称）。注意，要当心缩写。如果你是美国人，注意</span></span><br><span class="line"><span class="comment">#EST 是加拿大没有夏时制的一个时区。它表#示东部标准时间！我们还会在12.5 节中继</span></span><br><span class="line"><span class="comment">#续讨论这个话题。</span></span><br><span class="line"><span class="comment">#%z（与国际标准时间的时差，如+0800）。</span></span><br><span class="line"><span class="comment">#非数值字符</span></span><br><span class="line"><span class="comment">#%.（跳过一个非数值字符）。</span></span><br><span class="line"><span class="comment">#%*（跳过所有非数值字符）。</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="解析文件"><a href="#解析文件" class="headerlink" title="解析文件"></a>解析文件</h4><h2 id="ggplot2"><a href="#ggplot2" class="headerlink" title="ggplot2"></a>ggplot2</h2><h3 id="基础图画绘制"><a href="#基础图画绘制" class="headerlink" title="基础图画绘制"></a>基础图画绘制</h3><h4 id="数据（Data）和映射（Mapping）"><a href="#数据（Data）和映射（Mapping）" class="headerlink" title="数据（Data）和映射（Mapping）"></a>数据（Data）和映射（Mapping）</h4><h5 id="数据要求"><a href="#数据要求" class="headerlink" title="数据要求"></a>数据要求</h5><p>用于绘制图形的data frame或者tibble.</p>
<h5 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h5><p><strong>aes()</strong>函数是ggplot2中的映射函数, 所谓的映射即为数据集中的数据关联到相应的图形属性过程中一种对应关系, 图形的颜色，形状，分组等都可以通过通过数据集中的变量映射。</p>
<hr>
<p>将钻石数据集中克拉和价格映射为X,Y轴变量:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> diamond<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> carat<span class="punctuation">,</span> y <span class="operator">=</span> price<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>#将钻石的颜色（color）映射<strong>颜色</strong>属性：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>diamond<span class="punctuation">,</span> mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>carat<span class="punctuation">,</span> y<span class="operator">=</span>price<span class="punctuation">,</span> shape<span class="operator">=</span>cut<span class="punctuation">,</span> colour<span class="operator">=</span>color<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p<span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#绘制点图</span></span><br></pre></td></tr></table></figure>
<p>#将钻石的切工（cut）映射到<strong>形状</strong>属性：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>diamond<span class="punctuation">,</span> mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>carat<span class="punctuation">,</span> y<span class="operator">=</span>price<span class="punctuation">,</span> shape<span class="operator">=</span>cut<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p<span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#绘制点图</span></span><br></pre></td></tr></table></figure>
<p>#将钻石的切工（cut）映射到<strong>分组</strong>属性：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#默认分组设置, 即group=1p + geom_boxplot()</span></span><br><span class="line"><span class="comment">#分组(group)也是ggplot2种映射关系的一种, 如果需要把观测点按额外的离散变量进行分组处理, 必须修改默认的分组设置。</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>diamond<span class="punctuation">,</span> mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>carat<span class="punctuation">,</span> y<span class="operator">=</span>price<span class="punctuation">,</span> group<span class="operator">=</span>factor<span class="punctuation">(</span>cut<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p1 <span class="operator">+</span> geom_boxplot<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="几何对象（Geometric）"><a href="#几何对象（Geometric）" class="headerlink" title="几何对象（Geometric）"></a>几何对象（Geometric）</h4><h5 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h5><p><strong>单变量连续变量</strong>：可绘制直方图展示，提供一个连续变量，画出数据的分布。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>diamond<span class="punctuation">)</span><span class="operator">+</span>geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>price<span class="punctuation">,</span> fill<span class="operator">=</span>cut<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#以价格（price）变量为例，且按照不同的切工填充颜色(即一个直方内有不同颜色的切工块)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>diamond<span class="punctuation">)</span><span class="operator">+</span>geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>price<span class="punctuation">,</span> fill<span class="operator">=</span>cut<span class="punctuation">)</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;dodge&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#dodge选项使得原本纵向分布的&quot;切工&quot;块变为并列显示</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>diamond<span class="punctuation">)</span><span class="operator">+</span>geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>price<span class="punctuation">,</span> fill<span class="operator">=</span>cut<span class="punctuation">)</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;fill&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#设置使用position=&quot;fill&quot;，按相对比例画直方图,可以显示不同价格时,各切工所占比例</span></span><br></pre></td></tr></table></figure>
<h5 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h5><p><strong>单变量分类变量</strong>：可使用柱状图展示，提供一个x分类变量，画出数据的分布。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>diamond<span class="punctuation">)</span><span class="operator">+</span>geom_bar<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>clarity<span class="punctuation">,</span> fill<span class="operator">=</span>cut<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#以透明度（clarity）变量为分类，且按照不同的切工填充颜色</span></span><br><span class="line"><span class="comment">#ggplot自动计算分类数</span></span><br></pre></td></tr></table></figure>
<h5 id="箱式图"><a href="#箱式图" class="headerlink" title="箱式图"></a>箱式图</h5><p><strong>箱线图</strong>:  通过绘制观测数据的五数总括，即最小值、下四分位数、中位数、上四分位数以及最大值，描述了变量值的分布情况。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>diamond<span class="punctuation">)</span><span class="operator">+</span>geom_boxplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>cut<span class="punctuation">,</span> y<span class="operator">=</span>price<span class="punctuation">,</span>fill<span class="operator">=</span>color<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#按切工(cut)分类，对价格(price)变量画箱式图，再按照color变量分别填充颜色。</span></span><br></pre></td></tr></table></figure>
<h4 id="标尺（Scale）"><a href="#标尺（Scale）" class="headerlink" title="标尺（Scale）"></a>标尺（Scale）</h4><p>在对图形属性进行映射之后，使用<strong>标尺</strong>可以控制这些属性的显示方式，比如坐标刻度，颜色属性等。</p>
<p><strong>scale函数命名通式</strong>: 一般使用三个单词用”_”连接:</p>
<ol>
<li>第一个都是scale</li>
<li>第二个是color fill x y linetype shape size等可更改的参数</li>
<li>第三个是具体的类型.</li>
</ol>
<h5 id="颜色标尺"><a href="#颜色标尺" class="headerlink" title="颜色标尺"></a>颜色标尺</h5><h6 id="第二个参数"><a href="#第二个参数" class="headerlink" title="第二个参数"></a>第二个参数</h6><p>对于颜色scale函数,第二个有两个参数, 一个是fill,主要是指填充颜色;另一个是color,指点或者线的颜色;</p>
<h6 id="第三个参数"><a href="#第三个参数" class="headerlink" title="第三个参数"></a>第三个参数</h6><p>根据数据为离散型还是连续性决定;</p>
<p>1）离散型：在颜色变量是离散变量的时候使用，比如分类时每一类对应一种颜色</p>
<ul>
<li>manual 直接指定分组使用的颜色</li>
<li>hue 通过改变色相（hue）饱和度（chroma）亮度（luminosity）来调整颜色</li>
<li>brewer 使用ColorBrewer的颜色</li>
<li>grey 使用不同程度的灰色</li>
</ul>
<p><strong>manual</strong> 参数:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p<span class="operator">+</span>scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p<span class="operator">+</span>scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Fair&quot;</span><span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;Good&quot;</span> <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Very Good&quot;</span> <span class="operator">=</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> Premium <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> Ideal <span class="operator">=</span> <span class="string">&quot;yellow&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_fill_manual<span class="punctuation">(</span><span class="string">&quot;class&quot;</span><span class="punctuation">,</span> values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Fair&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Good&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Very Good&quot;</span><span class="punctuation">,</span><span class="string">&quot;Premium&quot;</span><span class="punctuation">,</span><span class="string">&quot;Ideal&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;一般&quot;</span><span class="punctuation">,</span> <span class="string">&quot;好&quot;</span><span class="punctuation">,</span> <span class="string">&quot;很好&quot;</span><span class="punctuation">,</span> <span class="string">&quot;高级&quot;</span><span class="punctuation">,</span> <span class="string">&quot;理想&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>brewer 使用ColorBrewer的颜色</strong>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#主要是palette参数调用色板</span></span><br><span class="line">p <span class="operator">+</span> scale_fill_brewer<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># 默认使用Blues调色板中的颜色</span></span><br><span class="line">p <span class="operator">+</span> scale_fill_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Greens&quot;</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#使用Greens调色板中的颜色</span></span><br><span class="line">p <span class="operator">+</span> scale_fill_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Greens&quot;</span><span class="punctuation">,</span>direction <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>direction参数决定颜色顺序, 为-1则反着来;</p>
<p><strong>grey 使用不同程度的灰色</strong>:</p>
<p>通过start end 两个参数指定，0为黑，1为白，都在0-1范围内</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">+</span> scale_fill_grey<span class="punctuation">(</span><span class="punctuation">)</span>  </span><br><span class="line"><span class="comment">#设定灰度范围</span></span><br><span class="line">p <span class="operator">+</span> scale_fill_grey<span class="punctuation">(</span>start<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> end<span class="operator">=</span><span class="number">0</span><span class="punctuation">)</span>  </span><br><span class="line">p <span class="operator">+</span> scale_fill_grey<span class="punctuation">(</span>start<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> end<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>2）连续型：颜色变量是连续变量的时候使用，比如0-100的数，数值越大颜色越深这样</p>
<ul>
<li>gradient 创建渐变色</li>
<li>distiller 使用ColorBrewer的颜色</li>
<li>identity 使用color变量对应的颜色，对离散型和连续型都有效</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span>y <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span>z1 <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour <span class="operator">=</span> z1<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>gradient 创建渐变色</strong>#参数设定节点颜色:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置两端颜色p + scale_color_gradient(low = &quot;white&quot;, high = &quot;black&quot;)</span></span><br><span class="line"><span class="comment">#设置中间过渡色</span></span><br><span class="line">p <span class="operator">+</span> scale_color_gradient2<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> mid <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#使用R预设调色板</span></span><br><span class="line">p <span class="operator">+</span> scale_color_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span>rainbow<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#legeng展示指定标签</span></span><br><span class="line">p <span class="operator">+</span> scale_color_gradient<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>                             breaks<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span>  labels<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span><span class="string">&quot;c&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#legend名称</span></span><br><span class="line">p <span class="operator">+</span> scale_color_gradient<span class="punctuation">(</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> low <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>       limits<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>distiller 使用ColorBrewer的颜色</strong>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">+</span> scale_color_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Spectral&quot;</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_color_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Greens&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h5 id="坐标轴尺度修改"><a href="#坐标轴尺度修改" class="headerlink" title="坐标轴尺度修改"></a>坐标轴尺度修改</h5><p>参数与上类似,第一个参数为scale, 然后是x,y表明对哪个轴操作,最后是详细操作;</p>
<ul>
<li>更改坐标轴名称</li>
<li>更改x轴上标数的位置和内容</li>
<li>显示对一个轴做统计变换</li>
<li>只展示一个区域内的点</li>
<li>更改刻度标签的位置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 横坐标是离散变量，纵坐标是连续变量</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>mtcars<span class="punctuation">,</span> aes<span class="punctuation">(</span>factor<span class="punctuation">(</span>cyl<span class="punctuation">)</span><span class="punctuation">,</span> mpg<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 更改坐标轴名称</span></span><br><span class="line">p <span class="operator">+</span> scale_x_discrete<span class="punctuation">(</span><span class="string">&quot;cyl&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 更改横轴标度</span></span><br><span class="line">p <span class="operator">+</span> scale_x_discrete<span class="punctuation">(</span>labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;4&quot;</span><span class="operator">=</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span><span class="string">&quot;6&quot;</span><span class="operator">=</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span><span class="string">&quot;8&quot;</span><span class="operator">=</span><span class="string">&quot;c&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 指定横轴顺序以及展示部分</span></span><br><span class="line">p <span class="operator">+</span> scale_x_discrete<span class="punctuation">(</span>limits<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;6&quot;</span><span class="punctuation">,</span><span class="string">&quot;4&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连续变量可以更改标度（图与上相似，略）</span></span><br><span class="line">p <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span><span class="string">&quot;ylab_mpg&quot;</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">,</span> labels<span class="operator">=</span>scales<span class="operator">::</span>dollar<span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 连续变量可以更改标度，还可以进行统计变换</span></span><br><span class="line">p <span class="operator">+</span> scale_y_reverse<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># 纵坐标翻转，小数在上面，大数在下面</span></span><br><span class="line">p <span class="operator">+</span> scale_y_log10<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span>trans <span class="operator">=</span> <span class="string">&quot;log10&quot;</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> scale_y_sqrt<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 更改刻度标签的位置</span></span><br><span class="line">p <span class="operator">+</span> scale_x_discrete<span class="punctuation">(</span>position <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>  scale_y_continuous<span class="punctuation">(</span>position <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/data-analysis/">data analysis</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/09/15/RstudioServer%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RstudioServer环境配置</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/09/15/RstudioServer%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="RstudioServer环境配置"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-15</div><div class="title">RstudioServer环境配置</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://gcore.jsdelivr.net/gh/Molaison/IMages/IMG/2022/10/1820221018081403.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Molaison</div><div class="author-info__description">Per Aspera Ad Astra.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" href="https://github.com/Molaison"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Molaison" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sub2pro@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.zhihu.com/people/wang-er-zhi-88" target="_blank" title="知乎"><i class="fab fa-zhihu"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tidyverse"><span class="toc-number">1.</span> <span class="toc-text">Tidyverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr%E5%8C%85-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.</span> <span class="toc-text">dplyr包: 数据转换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%92%8C%E5%8C%85%E8%BD%BD%E5%85%A5"><span class="toc-number">1.1.1.</span> <span class="toc-text">数据和包载入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">基础函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#filter-%E6%8C%89%E5%80%BC%E7%AD%9B%E9%80%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">filter(): 按值筛选</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%AF%94%E8%BE%83%E7%AC%A6"><span class="toc-number">1.1.2.1.1.</span> <span class="toc-text">基于比较符</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%80%BB%E8%BE%91%E7%AC%A6"><span class="toc-number">1.1.2.1.2.</span> <span class="toc-text">基于逻辑符</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC"><span class="toc-number">1.1.2.1.3.</span> <span class="toc-text">缺失值</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#arrange-%E5%AF%B9%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">arrange(): 对行排序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#select-%E6%8C%89%E5%90%8D%E7%A7%B0%E9%80%89%E5%8F%96"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">select(): 按名称选取</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.3.1.</span> <span class="toc-text">辅助函数</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mutate-%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E6%96%B0%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">mutate(): 使用函数创建新变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#summarize-%E6%91%98%E8%A6%81%E7%BB%9F%E8%AE%A1%E9%87%8F"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">summarize(): 摘要统计量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">管道操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%BF%BD%E7%95%A5%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">缺失值忽略参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%A1%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">计数参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%91%98%E8%A6%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">常见摘要函数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%8D%E7%BD%AE-median-%E5%92%8Cmean"><span class="toc-number">1.1.2.9.1.</span> <span class="toc-text">位置: median()和mean()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%86%E6%95%A3%E7%A8%8B%E5%BA%A6-sd-x-%E3%80%81IQR-x-%E5%92%8Cmad-x"><span class="toc-number">1.1.2.9.2.</span> <span class="toc-text">分散程度: sd(x)、IQR(x) 和mad(x)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A7%A9-min-x-%E3%80%81quantile-x-0-25-%E5%92%8Cmax-x"><span class="toc-number">1.1.2.9.3.</span> <span class="toc-text">秩: min(x)、quantile(x, 0.25) 和max(x)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%BA%A6%E9%87%8F%EF%BC%9Afirst-x-%E3%80%81nth-x-2-%E5%92%8Clast-x"><span class="toc-number">1.1.2.9.4.</span> <span class="toc-text">定位度量：first(x)、nth(x, 2) 和last(x)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AE%A1%E6%95%B0-count"><span class="toc-number">1.1.2.9.5.</span> <span class="toc-text">计数:count()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%80%BC%E8%AE%A1%E6%95%B0-sum-x-gt-a-%E5%92%8Cmean-x-0"><span class="toc-number">1.1.2.9.6.</span> <span class="toc-text">逻辑值计数: sum(x&gt;a)和mean(x&#x3D;&#x3D;0)</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%89%E5%A4%9A%E4%B8%AA%E5%8F%98%E9%87%8F%E5%88%86%E7%BB%84"><span class="toc-number">1.1.2.10.</span> <span class="toc-text">按多个变量分组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tibble%E6%95%B0%E6%8D%AE%E6%A1%86"><span class="toc-number">1.2.</span> <span class="toc-text">tibble数据框</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAtibble%E6%95%B0%E6%8D%AE%E6%A1%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">创建tibble数据框</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%8D%B0tibble"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">打印tibble()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%96%E5%AD%90%E9%9B%86"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">取子集</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readr"><span class="toc-number">1.3.</span> <span class="toc-text">readr</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text">读取文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%90%91%E9%87%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">解析向量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.3.</span> <span class="toc-text">解析文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ggplot2"><span class="toc-number">2.</span> <span class="toc-text">ggplot2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%9B%BE%E7%94%BB%E7%BB%98%E5%88%B6"><span class="toc-number">2.1.</span> <span class="toc-text">基础图画绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%EF%BC%88Data%EF%BC%89%E5%92%8C%E6%98%A0%E5%B0%84%EF%BC%88Mapping%EF%BC%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">数据（Data）和映射（Mapping）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A6%81%E6%B1%82"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">数据要求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">映射</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E5%AF%B9%E8%B1%A1%EF%BC%88Geometric%EF%BC%89"><span class="toc-number">2.1.2.</span> <span class="toc-text">几何对象（Geometric）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">直方图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">柱状图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%B1%E5%BC%8F%E5%9B%BE"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">箱式图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E5%B0%BA%EF%BC%88Scale%EF%BC%89"><span class="toc-number">2.1.3.</span> <span class="toc-text">标尺（Scale）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%9C%E8%89%B2%E6%A0%87%E5%B0%BA"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">颜色标尺</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.3.1.1.</span> <span class="toc-text">第二个参数</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.3.1.2.</span> <span class="toc-text">第三个参数</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E8%BD%B4%E5%B0%BA%E5%BA%A6%E4%BF%AE%E6%94%B9"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">坐标轴尺度修改</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/23/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%EF%BC%9ADigging-into-details/" title="Python面向对象：Digging into details">Python面向对象：Digging into details</a><time datetime="2023-07-23T02:37:12.000Z" title="发表于 2023-07-23 10:37:12">2023-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/19/Git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-From-Principles-to-Cases/" title="Git学习笔记: From Principles to Cases">Git学习笔记: From Principles to Cases</a><time datetime="2023-07-18T16:32:01.000Z" title="发表于 2023-07-19 00:32:01">2023-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/16/JavaScript%E9%80%86%E5%90%91Basics-%E5%8A%A0%E5%AF%86%E4%B8%8E%E5%AE%89%E5%85%A8/" title="JavaScript逆向Basics: 加密与安全">JavaScript逆向Basics: 加密与安全</a><time datetime="2023-06-16T00:18:31.000Z" title="发表于 2023-06-16 08:18:31">2023-06-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/15/Python%E7%88%AC%E8%99%AB%E7%AC%94%E8%AE%B0-Javascript%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/" title="Python爬虫笔记: Javascript逆向分析">Python爬虫笔记: Javascript逆向分析</a><time datetime="2023-06-15T09:25:52.000Z" title="发表于 2023-06-15 17:25:52">2023-06-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/14/%E5%86%8D%E8%AF%BBGeneXII-The-insight-of-biology/" title="再读GeneXII: The insight of biology">再读GeneXII: The insight of biology</a><time datetime="2023-06-14T09:27:46.000Z" title="发表于 2023-06-14 17:27:46">2023-06-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Molaison</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script type="text/javascript" src="/js/anchor_sign.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>